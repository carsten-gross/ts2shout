# ts2shout
ts2shout is a small software that acts as a filter to convert a single
program mpeg transport stream directly to a webradio compatible shoutcast stream. 
I actually use it for playing DVB-C on Squeezebox players. Please see my page 
http://www.siski.de/~carsten/radio-streaming-squeezebox.html for more information.

It is heavily based on the dvbshout application by Nicholas J. Humfrey
(https://github.com/njh/dvbshout) - but the use case here is completly
different. ts2shout uses autoconfiguration by reading PAT and PMT tables from a
single program mpeg transport stream and does not need a configuration nor does
it use any networking code. 

The ts2shout filter reads a mpeg transport stream directly from stdin
containing a single programm generated by applications like tvheadend. ts2shout
outputs a shoutcast stream with the first found mpeg audio stream in PAT/PMT
and the "current programm" from the mpeg EIT ("EPG") translated to
"StreamTitle" all 8192 bytes inside the mpeg stream. This is a standard for
most shoutcast radio-stations and described in
http://www.smackfu.com/stuff/programming/shoutcast.html. ts2shout should work
with most DVB-C/DVB-S radio stations and was tested by myself with Unitymedia
DVB-C network.

Just compile the application with make on your linux box and install it
manually e.g. to /usr/local/bin/ts2shout . It does not need any libraries for
shoutcast or mpeg as it just parses and uses a sub-extreme-minimum set of mpeg
specification just to work for me in my special setup to get stream information
on the Squeezebox.

It can be used in conjunction with tvheadend and apache as follows: 

Activate modules mod_proxy, mod_ext_filter, mod_proxy_http in apache2.

On a Debian system change /etc/apache2/mods-available/proxy.conf as follows. Please take care for the exakt URLs 
for your tvheadend stuff. 

You'll also get nice URLs for accessing the streams and you won't need
authentication anymore (as you have it for tvheadend). 

It assumes that your tvheadend is reachable via localhost. Change/Adjust ProxyPass for the radio-URL, and the allow/deny lists. 

If shoutcast Streamtitles should be used inside the stream is autodetected by
the Icy-MetaData header given in the http request. 

--- cite --- 
<pre>
ProxyRequests Off
	&lt;Proxy *&gt;
	#   AddDefaultCharset off
	#   Require all denied
		Order Deny,Allow
		Deny from all
		Allow from 172.16.0.0/24
		Allow from ::1
		Allow from 127.0.0.1
	&lt;/Proxy&gt;
	# Global settings for the all radios below "/radio" 
	ExtFilterDefine ts2shout mode=output intype=audio/mp2t outtype=audio/mpeg cmd="/usr/local/bin/ts2shout"
	ExtFilterDefine ts2noshout mode=output intype=audio/mp2t outtype=audio/mpeg cmd="/usr/local/bin/ts2shout noshout"
	&lt;Location /radio&gt;
			Order Deny,Allow
			Deny from all
			Allow from 172.16.0.0/24
			Allow from ::1
			Allow from 127.0.0.1
			ExtFilterOptions LogStderr
			# Password for authorization at tvheadend
			# dHY6Z3Vja2Vu = Login:tv Password:gucken
			# generated by echo -n "back-end_login:back-end_password" | base64
			RequestHeader set Authorization "Basic dHY6Z3Vja2Vu"
			Header set icy-br 320
			Header set icy-sr 48000
			Header set icy-url http://localhost/
			Header set icy-pub 1
			Header set icy-genre Misc
			&lt;If "%{HTTP:Icy-MetaData} in {'1'}"&gt;
				Header set icy-metaint 8192
				SetOutputFilter ts2shout
			&lt;/If&gt;
			&lt;Else&gt;
				SetOutputFilter ts2noshout
			&lt;/Else&gt;
	&lt;/Location&gt;
	# The List of radio Stations
	# This is a single radio station
	&lt;Location /radio/swr1bw&gt;
		Header set icy-name "SWR1 BW"
		ProxyPass http://localhost:9981/stream/channelnumber/813
	&lt;/Location&gt;
	# Add as many radio stations as you like. 
</pre>
--- cite --- 


